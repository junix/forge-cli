{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "version": "1.0.0",
  "metadata": {
    "description": "RAG Testing Specification for Knowledge Forge",
    "created": "2025-01-10",
    "authors": ["Claude Assistant"]
  },
  
  "defaults": {
    "base_url": "${KNOWLEDGE_FORGE_URL:-http://localhost:9999}",
    "timeout": 10,
    "vector_store_id": "a1b2c3d4-e5f6-7890-abcd-ef1234567890",
    "file_id": "f8e5d7c6-b9a8-4321-9876-543210abcdef",
    "model": "qwen3-235b-a22b",
    "effort": "low"
  },
  
  "test_suites": [
    {
      "name": "smoke_tests",
      "description": "Quick smoke tests to ensure basic functionality",
      "tests": [
        {
          "id": "smoke_plain_chat",
          "name": "Basic Plain Chat",
          "description": "Test simple chat without tools",
          "request": {
            "task_type": "plain-chat",
            "parameters": {
              "model": "qwen3-235b-a22b",
              "effort": "low",
              "query": "Hello! Please respond with a simple greeting."
            }
          },
          "expected": {
            "status_code": 200,
            "required_events": ["response.created", "response.output_text.delta", "response.done"],
            "response_contains": ["hello", "greeting", "hi"],
            "no_tool_calls": true
          }
        },
        {
          "id": "smoke_file_search",
          "name": "Basic File Search",
          "description": "Test file search with default vector store",
          "request": {
            "task_type": "file-search",
            "parameters": {
              "model": "qwen3-235b-a22b",
              "effort": "low",
              "query": "What information is available about machine learning?"
            }
          },
          "expected": {
            "status_code": 200,
            "required_events": [
              "response.created",
              "response.file_search_call.searching",
              "response.file_search_call.completed",
              "response.output_text.delta",
              "response.done"
            ],
            "tool_calls": ["file_search"]
          }
        },
        {
          "id": "smoke_web_search",
          "name": "Basic Web Search",
          "description": "Test web search functionality",
          "request": {
            "task_type": "web-search",
            "parameters": {
              "model": "qwen3-235b-a22b",
              "effort": "low",
              "query": "What are the latest AI developments?"
            }
          },
          "expected": {
            "status_code": 200,
            "required_events": [
              "response.created",
              "response.web_search_call.searching",
              "response.web_search_call.completed",
              "response.output_text.delta",
              "response.done"
            ],
            "tool_calls": ["web_search"]
          }
        }
      ]
    },
    
    {
      "name": "tool_choice_tests",
      "description": "Test different tool_choice parameter variations",
      "tests": [
        {
          "id": "tool_choice_auto",
          "name": "Tool Choice Auto",
          "description": "Test with tool_choice=auto",
          "request": {
            "task_type": "file-search",
            "parameters": {
              "model": "qwen3-235b-a22b",
              "effort": "low",
              "tool_choice": "auto",
              "query": "Search for information about neural networks"
            }
          },
          "expected": {
            "status_code": 200,
            "tool_choice_respected": true
          }
        },
        {
          "id": "tool_choice_none",
          "name": "Tool Choice None",
          "description": "Test with tool_choice=none (should not use tools)",
          "request": {
            "task_type": "file-search",
            "parameters": {
              "model": "qwen3-235b-a22b",
              "effort": "low",
              "tool_choice": "none",
              "query": "Tell me about machine learning without searching"
            }
          },
          "expected": {
            "status_code": 200,
            "no_tool_calls": true,
            "required_events": ["response.created", "response.output_text.delta", "response.done"]
          }
        },
        {
          "id": "tool_choice_required",
          "name": "Tool Choice Required",
          "description": "Test with tool_choice=required",
          "request": {
            "task_type": "file-search",
            "parameters": {
              "model": "qwen3-235b-a22b",
              "effort": "low",
              "tool_choice": "required",
              "query": "Find documents about deep learning"
            }
          },
          "expected": {
            "status_code": 200,
            "tool_calls_required": true,
            "min_tool_calls": 1
          }
        },
        {
          "id": "tool_choice_specific_function",
          "name": "Tool Choice Specific Function",
          "description": "Test with specific function tool choice",
          "request": {
            "task_type": "file-search",
            "parameters": {
              "model": "qwen3-235b-a22b",
              "effort": "low",
              "tool_choice": {
                "type": "function",
                "name": "search_documents"
              },
              "query": "Search for AI research papers"
            }
          },
          "expected": {
            "status_code": 200,
            "specific_tool_called": "search_documents"
          }
        },
        {
          "id": "tool_choice_hosted_tool",
          "name": "Tool Choice Hosted Tool",
          "description": "Test with hosted tool type",
          "request": {
            "task_type": "file-search",
            "parameters": {
              "model": "qwen3-235b-a22b",
              "effort": "low",
              "tool_choice": {
                "type": "file_search"
              },
              "query": "Find information about transformers"
            }
          },
          "expected": {
            "status_code": 200,
            "tool_calls": ["file_search"]
          }
        }
      ]
    },
    
    {
      "name": "effort_level_tests",
      "description": "Test different effort levels",
      "tests": [
        {
          "id": "effort_dev",
          "name": "Dev Effort Level",
          "description": "Test with effort=dev",
          "request": {
            "task_type": "plain-chat",
            "parameters": {
              "model": "qwen3-235b-a22b",
              "effort": "dev",
              "query": "Explain quantum computing"
            }
          },
          "expected": {
            "status_code": 200,
            "effort_applied": "dev"
          }
        },
        {
          "id": "effort_medium",
          "name": "Medium Effort Level",
          "description": "Test with effort=medium",
          "request": {
            "task_type": "file-search",
            "parameters": {
              "model": "qwen3-235b-a22b",
              "effort": "medium",
              "query": "Provide a detailed analysis of machine learning trends"
            }
          },
          "expected": {
            "status_code": 200,
            "effort_applied": "medium",
            "min_response_length": 500
          }
        },
        {
          "id": "effort_high",
          "name": "High Effort Level",
          "description": "Test with effort=high",
          "request": {
            "task_type": "file-search",
            "parameters": {
              "model": "qwen3-235b-a22b",
              "effort": "high",
              "query": "Comprehensive research on artificial general intelligence"
            }
          },
          "expected": {
            "status_code": 200,
            "effort_applied": "high",
            "min_response_length": 1000,
            "has_reasoning": true
          }
        }
      ]
    },
    
    {
      "name": "multi_tool_tests",
      "description": "Test multiple tools working together",
      "tests": [
        {
          "id": "multi_file_web_search",
          "name": "File and Web Search Combined",
          "description": "Test using both file search and web search",
          "request": {
            "task_type": ["file-search", "web-search"],
            "parameters": {
              "model": "qwen3-235b-a22b",
              "effort": "medium",
              "query": "Compare internal documents with latest web information on AI ethics"
            }
          },
          "expected": {
            "status_code": 200,
            "tool_calls": ["file_search", "web_search"],
            "required_events": [
              "response.file_search_call.searching",
              "response.file_search_call.completed",
              "response.web_search_call.searching",
              "response.web_search_call.completed"
            ]
          }
        },
        {
          "id": "multi_file_reader_search",
          "name": "File Reader with Search",
          "description": "Test file reader combined with vector search",
          "request": {
            "task_type": ["file-reader", "file-search"],
            "parameters": {
              "model": "qwen3-235b-a22b",
              "effort": "low",
              "file_id": "${defaults.file_id}",
              "query": "Analyze this document and find related information"
            }
          },
          "expected": {
            "status_code": 200,
            "has_file_content": true,
            "tool_calls": ["file_search"]
          }
        },
        {
          "id": "multi_all_tools",
          "name": "All Tools Combined",
          "description": "Test all three tools together",
          "request": {
            "task_type": ["file-reader", "file-search", "web-search"],
            "parameters": {
              "model": "qwen3-235b-a22b",
              "effort": "high",
              "file_id": "${defaults.file_id}",
              "query": "Comprehensive analysis using all available resources"
            }
          },
          "expected": {
            "status_code": 200,
            "tool_calls": ["file_search", "web_search"],
            "has_file_content": true,
            "min_response_length": 1500
          }
        }
      ]
    },
    
    {
      "name": "edge_case_tests",
      "description": "Test edge cases and error scenarios",
      "tests": [
        {
          "id": "edge_invalid_vector_store",
          "name": "Invalid Vector Store ID",
          "description": "Test with non-existent vector store",
          "request": {
            "task_type": "file-search",
            "parameters": {
              "model": "qwen3-235b-a22b",
              "effort": "low",
              "vector_store_id": "invalid-vector-store-id-12345",
              "query": "Search for something"
            }
          },
          "expected": {
            "status_code": [400, 404, 422],
            "error_message_contains": ["vector", "store", "not found"]
          }
        },
        {
          "id": "edge_conflicting_tool_choice",
          "name": "Conflicting Tool Choice",
          "description": "Test file search with tool_choice=none",
          "request": {
            "task_type": "file-search",
            "parameters": {
              "model": "qwen3-235b-a22b",
              "effort": "low",
              "tool_choice": "none",
              "query": "Search without using tools"
            }
          },
          "expected": {
            "status_code": 200,
            "no_tool_calls": true
          }
        },
        {
          "id": "edge_plain_chat_required_tool",
          "name": "Plain Chat with Required Tool",
          "description": "Test plain chat with tool_choice=required (should handle gracefully)",
          "request": {
            "task_type": "plain-chat",
            "parameters": {
              "model": "qwen3-235b-a22b",
              "effort": "low",
              "tool_choice": "required",
              "query": "Hello there"
            }
          },
          "expected": {
            "status_code": [200, 400, 422],
            "handles_gracefully": true
          }
        },
        {
          "id": "edge_empty_query",
          "name": "Empty Query",
          "description": "Test with empty query string",
          "request": {
            "task_type": "plain-chat",
            "parameters": {
              "model": "qwen3-235b-a22b",
              "effort": "low",
              "query": ""
            }
          },
          "expected": {
            "status_code": [200, 400],
            "handles_empty_input": true
          }
        }
      ]
    },
    
    {
      "name": "file_reader_tests",
      "description": "Specific tests for file reader functionality",
      "tests": [
        {
          "id": "file_reader_basic",
          "name": "Basic File Reader",
          "description": "Test file reader with default query",
          "request": {
            "task_type": "file-reader",
            "parameters": {
              "model": "qwen3-235b-a22b",
              "effort": "low",
              "file_id": "${defaults.file_id}",
              "query": "出差南京可以报销多少？"
            }
          },
          "expected": {
            "status_code": 200,
            "has_file_content": true,
            "response_language": "zh"
          }
        },
        {
          "id": "file_reader_custom_query",
          "name": "File Reader Custom Query",
          "description": "Test file reader with English query",
          "request": {
            "task_type": "file-reader",
            "parameters": {
              "model": "qwen3-235b-a22b",
              "effort": "medium",
              "file_id": "${defaults.file_id}",
              "query": "Summarize the key points in this document"
            }
          },
          "expected": {
            "status_code": 200,
            "has_file_content": true,
            "has_summary": true
          }
        }
      ]
    },
    
    {
      "name": "model_variation_tests",
      "description": "Test with different models",
      "tests": [
        {
          "id": "model_qwen_70b",
          "name": "Qwen 70B Model",
          "description": "Test with smaller Qwen model",
          "request": {
            "task_type": "plain-chat",
            "parameters": {
              "model": "qwen25-72b-a22b-instruct",
              "effort": "low",
              "query": "Explain neural networks briefly"
            }
          },
          "expected": {
            "status_code": 200,
            "model_used": "qwen25-72b-a22b-instruct"
          }
        },
        {
          "id": "model_deepseek",
          "name": "DeepSeek Model",
          "description": "Test with DeepSeek model",
          "request": {
            "task_type": "file-search",
            "parameters": {
              "model": "deepseek-chat",
              "effort": "medium",
              "query": "Find information about transformers architecture"
            }
          },
          "expected": {
            "status_code": 200,
            "model_used": "deepseek-chat"
          }
        }
      ]
    }
  ],
  
  "test_execution": {
    "parallel": false,
    "stop_on_failure": false,
    "retry_on_failure": 1,
    "log_level": "INFO",
    "report_format": ["json", "html", "console"]
  },
  
  "validation_rules": {
    "response_time_limits": {
      "plain-chat": 5000,
      "file-search": 10000,
      "web-search": 15000,
      "multi-tool": 20000
    },
    "required_headers": ["content-type", "server"],
    "sse_format": {
      "event_prefix": "event:",
      "data_prefix": "data:",
      "end_event": "response.done"
    }
  }
}